<script>
  import { browser } from "$app/env";

  import { token } from "$lib/auth";

  import Button from "$lib/components/button.svelte";

  import SuggestionModal from "./suggestion-modal.svelte";
  import ServiceMenu from "$lib/components/services/service-menu.svelte";
  import StateButtonMenu from "$lib/components/services/state-button-menu.svelte";

  export let service;
  export let onRefresh;

  let suggestionModalIsOpen = false;

  function handleSuggestion() {
    suggestionModalIsOpen = true;
    if (browser) {
      plausible("suggestion", {
        props: {
          service: service.name,
          slug: service.slug,
          structure: service.structureInfo.name,
          departement: service.department,
        },
      });
    }
  }
</script>

<div class="inline-flex flex-wrap items-start gap-s8">
  {#if $token && service.canWrite}
    <StateButtonMenu {service} {onRefresh} />
    <ServiceMenu {service} secondary {onRefresh} inline />
  {:else}
    <SuggestionModal {service} bind:isOpen={suggestionModalIsOpen} />
    <Button
      label="SuggÃ©rer une modification"
      secondary
      small
      on:click={handleSuggestion}
    />
  {/if}
</div>
